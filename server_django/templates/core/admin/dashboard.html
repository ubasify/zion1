{% extends 'base.html' %}
{% load humanize %}

{% block header_title %}System Admin Dashboard{% endblock %}

{% block header_actions %}
<div class="flex items-center gap-3">
    <span
        class="px-3 py-1 bg-brand-navy/10 text-brand-navy dark:bg-brand-teal/10 dark:text-brand-teal rounded-full text-[10px] font-bold uppercase tracking-wider">
        Super Admin Access
    </span>
</div>
{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- KPI Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Total Users -->
        <div class="glass p-6 rounded-2xl border border-white/10 relative overflow-hidden group">
            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <i data-lucide="users" class="w-12 h-12 text-brand-navy dark:text-brand-teal"></i>
            </div>
            <p class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-1">Total Staff/Users</p>
            <h3 class="text-3xl font-bold text-slate-900 dark:text-white">{{ total_users }}</h3>
            <div class="mt-4 flex items-center justify-between">
                <a href="{% url 'admin-user-list' %}"
                    class="text-xs font-bold text-brand-navy dark:text-brand-teal hover:underline flex items-center gap-1">
                    Manage Users <i data-lucide="arrow-right" class="w-3 h-3"></i>
                </a>
            </div>
        </div>

        <!-- Total Parishes -->
        <div class="glass p-6 rounded-2xl border border-white/10 relative overflow-hidden group">
            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <i data-lucide="home" class="w-12 h-12 text-orange-500"></i>
            </div>
            <p class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-1">Active Parishes</p>
            <h3 class="text-3xl font-bold text-slate-900 dark:text-white">{{ total_parishes }}</h3>
            <div class="mt-4 flex items-center justify-between">
                <a href="{% url 'admin-parish-list' %}"
                    class="text-xs font-bold text-brand-navy dark:text-brand-teal hover:underline flex items-center gap-1">
                    Manage Parishes <i data-lucide="arrow-right" class="w-3 h-3"></i>
                </a>
            </div>
        </div>

        <!-- Total Ministries -->
        <div class="glass p-6 rounded-2xl border border-white/10 relative overflow-hidden group">
            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <i data-lucide="briefcase" class="w-12 h-12 text-blue-500"></i>
            </div>
            <p class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-1">Ministries</p>
            <h3 class="text-3xl font-bold text-slate-900 dark:text-white">{{ total_ministries }}</h3>
            <div class="mt-4 flex items-center justify-between">
                <a href="{% url 'admin-ministry-list' %}"
                    class="text-xs font-bold text-brand-navy dark:text-brand-teal hover:underline flex items-center gap-1">
                    View Ministries <i data-lucide="arrow-right" class="w-3 h-3"></i>
                </a>
            </div>
        </div>

        <!-- Total Members -->
        <div class="glass p-6 rounded-2xl border border-white/10 relative overflow-hidden group">
            <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                <i data-lucide="user-check" class="w-12 h-12 text-green-500"></i>
            </div>
            <p class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-1">Church Members</p>
            <h3 class="text-3xl font-bold text-slate-900 dark:text-white">{{ total_members|intcomma }}</h3>
            <div class="mt-4 flex items-center justify-between">
                <a href="{% url 'member-list' %}"
                    class="text-xs font-bold text-brand-navy dark:text-brand-teal hover:underline flex items-center gap-1">
                    Database <i data-lucide="arrow-right" class="w-3 h-3"></i>
                </a>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Recent Users -->
        <div class="glass rounded-3xl border border-white/10 overflow-hidden">
            <div class="p-6 border-b border-white/10 flex items-center justify-between">
                <h3 class="font-bold text-slate-900 dark:text-white">Newest Staff Members</h3>
                <a href="{% url 'admin-user-list' %}"
                    class="text-xs text-slate-500 hover:text-brand-navy transition-colors font-bold uppercase tracking-wider">All
                    Users</a>
            </div>
            <div class="p-0">
                <table class="w-full text-left">
                    <tbody class="divide-y divide-white/5">
                        {% for u in recent_users %}
                        <tr class="hover:bg-white/5 transition-colors">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-8 h-8 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-[10px] font-bold text-slate-500">
                                        {{ u.username|first|upper }}
                                    </div>
                                    <div>
                                        <div class="flex items-center gap-1.5">
                                            <p class="text-sm font-bold text-slate-900 dark:text-white">
                                                {{ u.get_full_name|default:u.username }}
                                            </p>
                                            {% if u.member %}
                                            <span
                                                class="px-1.5 py-0.5 bg-brand-navy/5 text-brand-navy dark:bg-brand-teal/10 dark:text-brand-teal rounded text-[8px] font-black uppercase tracking-tighter">Member</span>
                                            {% endif %}
                                        </div>
                                        <p class="text-[10px] text-slate-500 font-medium">{{ u.email }}</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span
                                    class="px-2 py-0.5 rounded-full text-[9px] font-bold bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 uppercase tracking-wider">
                                    {{ u.get_role_id_display }}
                                </span>
                            </td>
                            <td class="px-6 py-4 text-right">
                                <span class="text-[10px] text-slate-400">{{ u.date_joined|date:"M d, Y" }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Recent Members -->
        <div class="glass rounded-3xl border border-white/10 overflow-hidden">
            <div class="p-6 border-b border-white/10 flex items-center justify-between">
                <h3 class="font-bold text-slate-900 dark:text-white">Recent Member Enrollments</h3>
                <a href="{% url 'member-list' %}"
                    class="text-xs text-slate-500 hover:text-brand-navy transition-colors font-bold uppercase tracking-wider">Database</a>
            </div>
            <div class="p-0">
                <table class="w-full text-left">
                    <tbody class="divide-y divide-white/5">
                        {% for m in recent_members %}
                        <tr class="hover:bg-white/5 transition-colors">
                            <td class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div
                                        class="w-8 h-8 rounded-full bg-brand-navy/10 text-brand-navy flex items-center justify-center text-[10px] font-bold">
                                        {{ m.first_name|first }}{{ m.last_name|first }}
                                    </div>
                                    <div>
                                        <p class="text-sm font-bold text-slate-900 dark:text-white">{{ m.first_name }}
                                            {{ m.last_name }}</p>
                                        <p class="text-[10px] text-slate-500 font-medium">{{ m.parish.name|default:"Main
                                            Campus" }}</p>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <span
                                    class="px-2 py-0.5 rounded-full text-[9px] font-bold bg-green-100 text-green-600 uppercase tracking-wider">
                                    Active
                                </span>
                            </td>
                            <td class="px-6 py-4 text-right">
                                <span class="text-[10px] text-slate-400">{{ m.created_at|date:"M d, Y" }}</span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

